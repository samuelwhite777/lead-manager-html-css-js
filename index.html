<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lead Manager - Modelo Básico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            @apply bg-slate-50 text-slate-700; 
        }
        .chart-container {
            position: relative; width: 100%; max-width: 500px; 
            margin-left: auto; margin-right: auto;
            height: 300px; 
            max-height: 350px;
        }
        @media (min-width: 768px) { .chart-container { height: 320px; } }
        @media (min-width: 1024px) { .chart-container { height: 350px; } }
        
        #app-header { height: 4.5rem; }
        #main-content { padding-top: 4.5rem; }

        .nav-link {
            display: flex; align-items: center; padding: 0.5rem 0.75rem; border-radius: 0.375rem;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out; 
            @apply text-slate-600 text-sm font-medium;
        }
        .nav-link:hover { @apply bg-indigo-100 text-indigo-700; }
        .nav-link.active { @apply bg-indigo-600 text-white; }
        .nav-link.active:hover { @apply bg-indigo-700; }
        #mobile-menu .nav-link { @apply px-4 py-3 w-full justify-start; }

        .modal-backdrop {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.6);
            display: flex; align-items: center; justify-content: center; z-index: 50;
            @apply transition-opacity duration-300 ease-in-out;
        }
        .modal-content {
             @apply bg-white rounded-lg shadow-xl w-11/12 md:max-w-2xl transform transition-all duration-300 ease-in-out scale-95 opacity-0;
        }
        .modal-backdrop:not(.hidden) .modal-content { @apply scale-100 opacity-100; }

        .status-badge {
            padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem;
            font-weight: 600; text-transform: uppercase;
        }
        
        .auth-container { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1rem; @apply bg-slate-100; }
        .auth-card { @apply bg-white p-8 rounded-xl shadow-2xl border border-slate-200 w-full; }
        @media (min-width: 640px) { .auth-card { max-width: 28rem; } }
        
        .form-input {
            width: 100%; padding: 0.625rem 1rem; border-radius: 0.5rem;
            @apply border-slate-300 bg-white text-slate-900 placeholder-slate-400;
            transition: ring 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }
        .form-input:focus { outline: none; @apply ring-2 ring-indigo-500 border-indigo-500; }
        .form-label { display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.25rem; @apply text-slate-600; }
        .card { @apply bg-white p-6 rounded-lg shadow-lg border border-slate-200; }
        .text-primary-accent { @apply text-indigo-600; }
        .button-primary { @apply bg-indigo-600 hover:bg-indigo-700 text-white transition-all duration-200 ease-in-out focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500; }
        .button-secondary { @apply bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 transition-all duration-200 ease-in-out focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500; }
        .table-header { @apply bg-slate-50; }
        .table-cell-muted { @apply text-slate-500; }
        .table-row-hover:hover { @apply bg-slate-50; }
    </style>
</head>
<body class="text-slate-700">

    <div id="auth-section">
        <div id="view-login" class="auth-container">
            <div class="auth-card">
                <div class="flex justify-center items-center gap-3 mb-8">
                    <div class="p-3 bg-indigo-600 rounded-xl"><svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></div>
                    <h1 class="text-3xl font-bold text-slate-800">Lead Manager</h1>
                </div>
                <h2 class="text-2xl font-semibold text-center text-slate-700 mb-6">Acessar Sistema</h2>
                <form id="login-form">
                    <div class="mb-4"><label for="username" class="form-label">Usuário</label><input type="text" id="username" name="username" required class="form-input" placeholder="admin"></div>
                    <div class="mb-6"><label for="password" class="form-label">Senha</label><input type="password" id="password" name="password" required class="form-input" placeholder="password"></div>
                    <button type="submit" class="w-full button-primary font-semibold py-3 px-4 rounded-lg">Entrar</button>
                    <p id="login-error-message" class="mt-4 text-center text-sm text-red-600 hidden"></p>
                </form>
                <p class="mt-6 text-center text-sm"><span class="text-slate-500">Não tem uma conta?</span> <a href="#" id="show-register-link" class="font-medium text-primary-accent hover:underline">Cadastre-se</a></p>
                <p class="mt-2 text-center text-xs text-slate-400">Use 'admin' / 'password' para testar o login.</p>
            </div>
        </div>

        <div id="view-register" class="auth-container hidden">
            <div class="auth-card">
                 <div class="flex justify-center items-center gap-3 mb-6">
                     <div class="p-3 bg-indigo-600 rounded-xl"><svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"></path></svg></div>
                    <h1 class="text-3xl font-bold text-slate-800">Criar Conta</h1>
                </div>
                <form id="register-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                        <div><label for="reg-fullname" class="form-label">Nome Completo</label><input type="text" id="reg-fullname" name="reg-fullname" required class="form-input"></div>
                        <div><label for="reg-email" class="form-label">Email</label><input type="email" id="reg-email" name="reg-email" required class="form-input"></div>
                        <div><label for="reg-phone" class="form-label">Telefone</label><input type="tel" id="reg-phone" name="reg-phone" class="form-input" placeholder="(00) 00000-0000"></div>
                        <div><label for="reg-password" class="form-label">Senha</label><input type="password" id="reg-password" name="reg-password" required class="form-input"></div>
                        <div><label for="reg-confirm-password" class="form-label">Confirmar Senha</label><input type="password" id="reg-confirm-password" name="reg-confirm-password" required class="form-input"></div>
                    </div>
                    <button type="submit" class="w-full mt-8 button-primary font-semibold py-3 px-4 rounded-lg">Criar Conta</button>
                    <p id="register-error-message" class="mt-4 text-center text-sm text-red-600 hidden"></p>
                    <p id="register-success-message" class="mt-4 text-center text-sm text-green-600 hidden"></p>
                </form>
                <p class="mt-6 text-center text-sm"><span class="text-slate-500">Já tem uma conta?</span> <a href="#" id="show-login-link" class="font-medium text-primary-accent hover:underline">Faça Login</a></p>
            </div>
        </div>
    </div>

    <div id="app" class="flex flex-col min-h-screen hidden">
        <header id="app-header" class="bg-white border-b border-slate-200 px-4 sticky top-0 z-30">
            <div class="container mx-auto flex items-center justify-between h-full">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-indigo-600 rounded-lg shrink-0">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                    </div>
                    <h1 class="text-xl font-bold text-slate-800">Lead Manager</h1>
                </div>

                <div class="md:hidden">
                    <button id="mobile-menu-toggle" class="p-2 rounded-md hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <svg id="icon-menu-open" class="w-6 h-6 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                        <svg id="icon-menu-close" class="w-6 h-6 text-slate-600 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <nav id="main-nav" class="hidden md:flex md:items-center md:gap-1 lg:gap-2">
                    <a id="nav-dashboard" class="nav-link active"><svg class="w-5 h-5 mr-1.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>Dashboard</a>
                    <a id="nav-manage" class="nav-link"><svg class="w-5 h-5 mr-1.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>Gerenciar Leads</a>
                    <a id="nav-upload" class="nav-link"><svg class="w-5 h-5 mr-1.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-4-4V6a4 4 0 014-4h10a4 4 0 014 4v6a4 4 0 01-4 4H7zM16 16v-4a4 4 0 00-4-4H4"></path></svg>Upload de Leads</a>
                </nav>
            </div>
             <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-slate-200 shadow-lg py-2">
                </div>
        </header>

        <main id="main-content" class="flex-1 p-4 md:p-8 overflow-y-auto">
            <div id="view-dashboard" class="card">
                <h2 class="text-3xl font-bold text-slate-800 mb-2">Dashboard</h2>
                <p class="text-slate-500 mb-8">Visão geral da performance dos seus leads.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <div class="card"><h3 class="text-sm font-medium text-slate-500">Total de Leads</h3><p id="kpi-total-leads" class="text-3xl font-bold text-slate-800 mt-2">0</p></div>
                    <div class="card"><h3 class="text-sm font-medium text-slate-500">Leads Novos</h3><p id="kpi-new-leads" class="text-3xl font-bold text-slate-800 mt-2">0</p></div>
                    <div class="card"><h3 class="text-sm font-medium text-slate-500">Taxa de Conversão</h3><p id="kpi-conversion-rate" class="text-3xl font-bold text-slate-800 mt-2">0%</p></div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="card">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">Leads por Status</h3>
                        <div class="chart-container"><canvas id="statusChart"></canvas></div>
                    </div>
                    <div class="card">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">Leads por Campanha</h3>
                        <div class="chart-container"><canvas id="campaignChart"></canvas></div>
                    </div>
                </div>
            </div>

            <div id="view-manage" class="hidden card">
                 <h2 class="text-3xl font-bold text-slate-800 mb-2">Gerenciar Leads</h2>
                 <p class="text-slate-500 mb-8">Visualize, filtre e gerencie seus leads.</p>
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <input id="filter-search" type="text" placeholder="Buscar por nome ou email..." class="form-input">
                    <select id="filter-status" class="form-input"><option value="">Todos os Status</option></select>
                    <select id="filter-campaign" class="form-input"><option value="">Todas as Campanhas</option></select>
                 </div>
                 <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-200">
                        <thead class="table-header">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium table-cell-muted uppercase tracking-wider">Nome Completo</th>
                                <th class="px-6 py-3 text-left text-xs font-medium table-cell-muted uppercase tracking-wider">Email</th>
                                <th class="px-6 py-3 text-left text-xs font-medium table-cell-muted uppercase tracking-wider">Campanha</th>
                                <th class="px-6 py-3 text-left text-xs font-medium table-cell-muted uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium table-cell-muted uppercase tracking-wider">Data</th>
                            </tr>
                        </thead>
                        <tbody id="leads-table-body" class="bg-white divide-y divide-slate-200">
                            </tbody>
                    </table>
                 </div>
            </div>
            
            <div id="view-upload" class="hidden card">
                <h2 class="text-3xl font-bold text-slate-800 mb-2">Upload de Leads</h2>
                <p class="text-slate-500 mb-8">Importe novos leads via arquivos CSV ou XLSX.</p>
                <div class="bg-white p-8 rounded-lg shadow-sm border border-slate-200 max-w-2xl mx-auto">
                    <div id="upload-area" class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-slate-300 border-dashed rounded-md">
                        <div class="space-y-1 text-center">
                            <svg class="mx-auto h-12 w-12 text-slate-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
                            <div class="flex text-sm text-slate-600">
                                <label for="file-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-primary-accent hover:underline focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
                                    <span>Carregue um arquivo</span>
                                    <input id="file-upload" name="file-upload" type="file" class="sr-only">
                                </label>
                                <p class="pl-1">ou arraste e solte</p>
                            </div>
                            <p class="text-xs text-slate-500">CSV, XLSX até 10MB</p>
                        </div>
                    </div>
                    <p id="file-name" class="mt-4 text-center text-sm text-slate-600"></p>
                    <button id="process-upload" class="mt-6 w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium button-primary disabled:opacity-50" disabled>Processar Arquivo</button>
                    <div id="upload-feedback" class="mt-4 text-center"></div>
                </div>
            </div>
        </main>
    </div>

    <div id="lead-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="p-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 id="modal-lead-name" class="text-2xl font-bold text-slate-800"></h3>
                        <p id="modal-lead-email" class="text-sm text-slate-500"></p>
                        <p id="modal-lead-phone" class="text-sm text-slate-500"></p>
                    </div>
                    <button id="modal-close" class="p-1 rounded-full hover:bg-slate-200 transition-colors duration-200">
                        <svg class="w-6 h-6 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                <hr class="my-4 border-slate-200">
                <div id="modal-body-details" class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4">
                    <div><p class="font-semibold text-slate-600">Campanha:</p><p id="modal-lead-campaign" class="text-slate-800"></p></div>
                    <div><p class="font-semibold text-slate-600">Origem:</p><p id="modal-lead-source" class="text-slate-800"></p></div>
                    <div><p class="font-semibold text-slate-600">Data de Criação:</p><p id="modal-lead-date" class="text-slate-800"></p></div>
                </div>
                 <div id="modal-form-fields">
                    <label for="modal-lead-status" class="form-label">Alterar Status</label>
                    <select id="modal-lead-status" class="form-input mt-1"></select>
                    <label for="modal-lead-notes" class="form-label mt-4">Notas</label>
                    <textarea id="modal-lead-notes" rows="3" class="form-input mt-1 p-2"></textarea>
                </div>
            </div>
            <div class="bg-slate-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse rounded-b-lg border-t border-slate-200">
                <button id="modal-save" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 button-primary text-base font-medium sm:ml-3 sm:w-auto sm:text-sm">Salvar</button> 
                <button id="modal-cancel" type="button" class="mt-3 w-full inline-flex justify-center rounded-md shadow-sm px-4 py-2 button-secondary text-base font-medium sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">Cancelar</button>
            </div>
        </div>
    </div>

    <button id="whatsapp-support" class="fixed bottom-6 right-6 bg-green-500 hover:bg-green-600 text-white p-4 rounded-full shadow-lg z-40 transition-transform hover:scale-110 active:scale-100">
        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448L.057 24zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.149-.172.198-.296.297-.495.099-.198.05-.372-.025-.521-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01s-.521.074-.794.372c-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.289.173-1.413z"/></svg>
    </button>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const authSectionEl = document.getElementById('auth-section');
            const loginViewEl = document.getElementById('view-login');
            const registerViewEl = document.getElementById('view-register');
            const appViewEl = document.getElementById('app');
            const leadModalEl = document.getElementById('lead-modal');
            
            const mobileMenuToggleBtn = document.getElementById('mobile-menu-toggle');
            const iconMenuOpen = document.getElementById('icon-menu-open');
            const iconMenuClose = document.getElementById('icon-menu-close');
            const mobileMenuEl = document.getElementById('mobile-menu');
            const mainNavEl = document.getElementById('main-nav');

            const loginFormEl = document.getElementById('login-form');
            const registerFormEl = document.getElementById('register-form');
            
            const loginErrorMsgEl = document.getElementById('login-error-message');
            const registerErrorMsgEl = document.getElementById('register-error-message');
            const registerSuccessMsgEl = document.getElementById('register-success-message');

            const showRegisterLink = document.getElementById('show-register-link');
            const showLoginLink = document.getElementById('show-login-link');
            
            const mockLeads = [ 
                { id: 1, facebook_lead_id: '1001', created_time: '2025-05-30T10:00:00Z', ad_name: 'Anúncio Lookalike', campaign_name: 'Campanha Verão 2025', form_name: 'Form Contato Rápido', full_name: 'Ana Silva', email: 'ana.silva@example.com', phone_number: '11987654321', status: 'novo', source: 'api_facebook', notes: '' },
                { id: 2, facebook_lead_id: '1002', created_time: '2025-05-30T11:20:00Z', ad_name: 'Anúncio Remarketing', campaign_name: 'Campanha Inverno 2025', form_name: 'Form Baixar Ebook', full_name: 'Bruno Costa', email: 'bruno.costa@example.com', phone_number: '21912345678', status: 'contatado', source: 'api_facebook', notes: 'Ligação realizada.' },
                { id: 3, facebook_lead_id: '1003', created_time: '2025-05-29T15:00:00Z', ad_name: 'Anúncio Lookalike', campaign_name: 'Campanha Verão 2025', form_name: 'Form Contato Rápido', full_name: 'Carla Dias', email: 'carla.dias@example.com', phone_number: '31988887777', status: 'qualificado', source: 'upload_csv', notes: 'Demonstrou forte interesse no produto X.' },
                { id: 4, facebook_lead_id: '1004', created_time: '2025-05-29T18:45:00Z', ad_name: 'Anúncio Público Aberto', campaign_name: 'Campanha Institucional', form_name: 'Form Newsletter', full_name: 'Daniel Martins', email: 'daniel.martins@example.com', phone_number: '41999998888', status: 'convertido', source: 'upload_xlsx', notes: 'Assinou o plano premium.' },
                { id: 5, facebook_lead_id: '1005', created_time: '2025-05-28T09:10:00Z', ad_name: 'Anúncio Remarketing', campaign_name: 'Campanha Inverno 2025', form_name: 'Form Baixar Ebook', full_name: 'Eduarda Fernandes', email: 'eduarda.f@example.com', phone_number: '51977776666', status: 'perdido', source: 'api_facebook', notes: 'Optou pelo concorrente.' },
            ];
            
            let isMobileMenuOpen = false;
            let currentLeadId = null; 
            let statusChartInstance, campaignChartInstance; 

            const views = { 
                dashboard: document.getElementById('view-dashboard'),
                manage: document.getElementById('view-manage'),
                upload: document.getElementById('view-upload'),
            };

            const navLinks = { 
                dashboard: document.getElementById('nav-dashboard'),
                manage: document.getElementById('nav-manage'),
                upload: document.getElementById('nav-upload')
            };
            
            const leadStatuses = ['novo', 'contatado', 'qualificado', 'convertido', 'perdido'];
            const statusColors = { 
                novo: '#3b82f6', contatado: '#f97316', qualificado: '#8b5cf6',
                convertido: '#16a34a', perdido: '#ef4444',
            };
             const statusBackgrounds = { 
                novo: 'bg-blue-100 text-blue-800', 
                contatado: 'bg-orange-100 text-orange-800',
                qualificado: 'bg-purple-100 text-purple-800', 
                convertido: 'bg-green-100 text-green-800',
                perdido: 'bg-red-100 text-red-800',
            };
            
            const initializeSystem = () => {
                appViewEl.classList.add('hidden');
                authSectionEl.classList.remove('hidden');
                showLoginView();

                if (loginFormEl) loginFormEl.addEventListener('submit', handleLoginAttempt);
                if (registerFormEl) registerFormEl.addEventListener('submit', handleRegisterAttempt);
                if (showRegisterLink) showRegisterLink.addEventListener('click', (e) => { e.preventDefault(); showRegisterView(); });
                if (showLoginLink) showLoginLink.addEventListener('click', (e) => { e.preventDefault(); showLoginView(); });
                if (mobileMenuToggleBtn) mobileMenuToggleBtn.addEventListener('click', toggleMobileMenu);
                
                document.getElementById('whatsapp-support').addEventListener('click', openWhatsAppSupport);
                
                if (Chart.defaults) { 
                    Chart.defaults.color = '#475569'; 
                    Chart.defaults.borderColor = 'rgba(203, 213, 225, 0.5)';
                }
                populateMobileMenu();
            };

            const showLoginView = () => {
                loginViewEl.classList.remove('hidden');
                registerViewEl.classList.add('hidden');
                if (loginErrorMsgEl) loginErrorMsgEl.classList.add('hidden');
            };

            const showRegisterView = () => {
                loginViewEl.classList.add('hidden');
                registerViewEl.classList.remove('hidden');
                if (registerErrorMsgEl) registerErrorMsgEl.classList.add('hidden');
                if (registerSuccessMsgEl) registerSuccessMsgEl.classList.add('hidden');
            };
            
            const toggleMobileMenu = () => {
                isMobileMenuOpen = !isMobileMenuOpen;
                mobileMenuEl.classList.toggle('hidden', !isMobileMenuOpen);
                iconMenuOpen.classList.toggle('hidden', isMobileMenuOpen);
                iconMenuClose.classList.toggle('hidden', !isMobileMenuOpen);
            };

            const populateMobileMenu = () => {
                if (!mainNavEl || !mobileMenuEl) return;
                mobileMenuEl.innerHTML = ''; 
                const desktopLinks = mainNavEl.querySelectorAll('a.nav-link'); 
                desktopLinks.forEach(link => {
                    const navKey = link.id.replace('nav-', '');
                    if (views[navKey]) {
                        const mobileLink = link.cloneNode(true);
                        mobileLink.addEventListener('click', () => {
                            navigate(navKey); 
                            if (isMobileMenuOpen) toggleMobileMenu(); 
                        });
                        mobileMenuEl.appendChild(mobileLink);
                    }
                });
            };

            const handleLoginAttempt = (event) => {
                event.preventDefault();
                const username = event.target.username.value;
                const password = event.target.password.value;
                if (username === 'admin' && password === 'password') {
                    authSectionEl.classList.add('hidden');
                    appViewEl.classList.remove('hidden');
                    if(loginErrorMsgEl) loginErrorMsgEl.classList.add('hidden');
                    initializeAppLogic();
                } else {
                    if(loginErrorMsgEl) {
                        loginErrorMsgEl.textContent = 'Usuário ou senha inválidos.';
                        loginErrorMsgEl.classList.remove('hidden');
                    }
                }
            };

            const handleRegisterAttempt = (event) => {
                event.preventDefault();
                const passwordInput = document.getElementById('reg-password');
                const confirmPasswordInput = document.getElementById('reg-confirm-password');
                
                if (!passwordInput || !confirmPasswordInput) return; 

                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;

                if (registerErrorMsgEl) registerErrorMsgEl.classList.add('hidden');
                if (registerSuccessMsgEl) registerSuccessMsgEl.classList.add('hidden');

                if (password !== confirmPassword) {
                    if (registerErrorMsgEl) {
                        registerErrorMsgEl.textContent = 'As senhas não coincidem.';
                        registerErrorMsgEl.classList.remove('hidden');
                    }
                    return;
                }
                
                if (registerSuccessMsgEl) {
                     registerSuccessMsgEl.textContent = 'Cadastro realizado com sucesso! (Simulado). Você pode fazer login agora.';
                     registerSuccessMsgEl.classList.remove('hidden');
                }
                if(registerFormEl) registerFormEl.reset();
                setTimeout(() => { showLoginView(); }, 2500);
            };
            
            const initializeAppLogic = () => {
                Object.keys(navLinks).forEach(key => { 
                    if (navLinks[key]) navLinks[key].addEventListener('click', () => navigate(key));
                });

                const filterSearch = document.getElementById('filter-search');
                const filterStatus = document.getElementById('filter-status');
                const filterCampaign = document.getElementById('filter-campaign');

                if(filterSearch) filterSearch.addEventListener('input', renderLeadsTable);
                if(filterStatus) filterStatus.addEventListener('change', renderLeadsTable);
                if(filterCampaign) filterCampaign.addEventListener('change', renderLeadsTable);
                
                document.getElementById('modal-close').addEventListener('click', closeModal);
                document.getElementById('modal-cancel').addEventListener('click', closeModal);
                document.getElementById('modal-save').addEventListener('click', saveLeadChanges);

                document.getElementById('file-upload').addEventListener('change', handleFileSelect);
                document.getElementById('process-upload').addEventListener('click', processUpload);
                
                populateFilters(); 
                updateAllVisuals(); 
                navigate('dashboard');
            };

            const navigate = (viewName) => {
                Object.values(views).forEach(v => { 
                    if (v && v.classList) v.classList.add('hidden');
                });
                if(views[viewName] && views[viewName].classList) {
                     views[viewName].classList.remove('hidden');
                } else if (views.dashboard) { 
                    views.dashboard.classList.remove('hidden');
                    viewName = 'dashboard'; 
                }
                
                document.querySelectorAll('#main-nav .nav-link, #mobile-menu .nav-link').forEach(l => {
                    l.classList.remove('active');
                     const linkViewName = l.id.replace('nav-', '');
                    if (linkViewName === viewName && navLinks[linkViewName]) { 
                        l.classList.add('active');
                    }
                });
            };
            
            const updateAllVisuals = () => { 
                updateKPIs(); 
                createOrUpdateCharts(); 
                renderLeadsTable(); 
            };

            const updateKPIs = () => { 
                const totalLeadsEl = document.getElementById('kpi-total-leads');
                const newLeadsEl = document.getElementById('kpi-new-leads');
                const conversionRateEl = document.getElementById('kpi-conversion-rate');

                if(totalLeadsEl) totalLeadsEl.textContent = mockLeads.length;
                if(newLeadsEl) newLeadsEl.textContent = mockLeads.filter(l => l.status === 'novo').length;
                const converted = mockLeads.filter(l => l.status === 'convertido').length;
                if(conversionRateEl) conversionRateEl.textContent = mockLeads.length > 0 ? `${((converted/mockLeads.length)*100).toFixed(1)}%` : '0%';
            };
            
            const createOrUpdateCharts = () => {
                const statusCtx = document.getElementById('statusChart').getContext('2d');
                const campaignCtx = document.getElementById('campaignChart').getContext('2d');
                const chartTextColor = '#475569'; 
                const chartGridColor = 'rgba(203, 213, 225, 0.5)'; 
                const doughnutBorderColor = '#ffffff'; 

                Chart.defaults.color = chartTextColor;
                
                const statusCounts = leadStatuses.reduce((acc, status) => {
                    acc[status] = mockLeads.filter(lead => lead.status === status).length; return acc;
                }, {});
                const campaignData = mockLeads.reduce((acc, lead) => {
                    acc[lead.campaign_name] = (acc[lead.campaign_name] || 0) + 1; return acc;
                }, {});

                if (statusChartInstance) statusChartInstance.destroy();
                statusChartInstance = new Chart(statusCtx, {
                    type: 'doughnut',
                    data: { 
                        labels: leadStatuses.map(s => s.charAt(0).toUpperCase() + s.slice(1)),
                        datasets: [{ 
                            data: Object.values(statusCounts), 
                            backgroundColor: leadStatuses.map(s => statusColors[s]), 
                            borderColor: doughnutBorderColor, 
                            borderWidth: 3, 
                        }]
                    }, 
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        plugins: { 
                            legend: { 
                                position: 'bottom', 
                                labels: { color: chartTextColor, padding: 20, font: {size: 12} } 
                            } 
                        } 
                    }
                });

                if (campaignChartInstance) campaignChartInstance.destroy();
                campaignChartInstance = new Chart(campaignCtx, {
                    type: 'bar',
                    data: { 
                        labels: Object.keys(campaignData),
                        datasets: [{ 
                            label: 'Nº de Leads', 
                            data: Object.values(campaignData), 
                            backgroundColor: 'rgba(79, 70, 229, 0.7)', 
                            borderColor: 'rgba(79, 70, 229, 1)', 
                            borderWidth: 1, 
                            borderRadius: 4 
                        }] 
                    }, 
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        scales: { 
                            y: { beginAtZero: true, ticks: { color: chartTextColor }, grid: { color: chartGridColor, drawBorder: false} },
                            x: { ticks: { color: chartTextColor }, grid: { display: false, drawBorder: false} }
                        }, 
                        plugins: { legend: { display: false } } 
                    }
                });
            };

            const populateFilters = () => {
                const statusFilterEl = document.getElementById('filter-status');
                const campaignFilterEl = document.getElementById('filter-campaign');
                const modalStatusSelectEl = document.getElementById('modal-lead-status');

                if (statusFilterEl) {
                    statusFilterEl.innerHTML = '<option value="">Todos os Status</option>'; 
                    leadStatuses.forEach(status => {
                        const option = document.createElement('option');
                        option.value = status;
                        option.textContent = status.charAt(0).toUpperCase() + status.slice(1);
                        statusFilterEl.appendChild(option);
                    });
                }
                if (modalStatusSelectEl) {
                    modalStatusSelectEl.innerHTML = ''; 
                     leadStatuses.forEach(status => {
                        const option = document.createElement('option');
                        option.value = status;
                        option.textContent = status.charAt(0).toUpperCase() + status.slice(1);
                        modalStatusSelectEl.appendChild(option);
                    });
                }

                if (campaignFilterEl) {
                    campaignFilterEl.innerHTML = '<option value="">Todas as Campanhas</option>'; 
                    const uniqueCampaigns = [...new Set(mockLeads.map(l => l.campaign_name))];
                    uniqueCampaigns.sort().forEach(campaign => {
                        if (campaign) { 
                            const option = document.createElement('option');
                            option.value = campaign;
                            option.textContent = campaign;
                            campaignFilterEl.appendChild(option);
                        }
                    });
                }
                const filterSearchEl = document.getElementById('filter-search');
                if(filterSearchEl) filterSearchEl.disabled = false;
                if(statusFilterEl) statusFilterEl.disabled = false;
                if(campaignFilterEl) campaignFilterEl.disabled = false;
                if(filterSearchEl) filterSearchEl.classList.remove('opacity-50');
                if(statusFilterEl) statusFilterEl.classList.remove('opacity-50');
                if(campaignFilterEl) campaignFilterEl.classList.remove('opacity-50');
            };

            const renderLeadsTable = () => {
                const tableBody = document.getElementById('leads-table-body');
                if (!tableBody) return;

                const searchTerm = document.getElementById('filter-search').value.toLowerCase();
                const statusFilter = document.getElementById('filter-status').value;
                const campaignFilter = document.getElementById('filter-campaign').value;

                const filteredLeads = mockLeads.filter(lead => {
                    const nameMatch = lead.full_name ? lead.full_name.toLowerCase().includes(searchTerm) : false;
                    const emailMatch = lead.email ? lead.email.toLowerCase().includes(searchTerm) : false;
                    const matchesSearch = nameMatch || emailMatch;
                    const matchesStatus = statusFilter ? lead.status === statusFilter : true;
                    const matchesCampaign = campaignFilter ? lead.campaign_name === campaignFilter : true;
                    return matchesSearch && matchesStatus && matchesCampaign;
                });

                tableBody.innerHTML = '';
                if (filteredLeads.length === 0) {
                    tableBody.innerHTML = `<tr><td colspan="5" class="text-center py-8 text-slate-500">Nenhum lead encontrado com os filtros aplicados.</td></tr>`; 
                    return;
                }

                filteredLeads.forEach(lead => {
                    const row = document.createElement('tr');
                    row.className = 'table-row-hover cursor-pointer';
                    row.dataset.leadId = lead.id;
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-slate-900">${lead.full_name || 'N/A'}</div></td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm table-cell-muted">${lead.email || 'N/A'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm table-cell-muted">${lead.campaign_name || 'N/A'}</td>
                        <td class="px-6 py-4 whitespace-nowrap"><span class="status-badge ${statusBackgrounds[lead.status] || 'bg-gray-100 text-gray-800'}">${lead.status || 'N/A'}</span></td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm table-cell-muted">${lead.created_time ? new Date(lead.created_time).toLocaleDateString('pt-BR') : 'N/A'}</td>
                    `;
                    row.addEventListener('click', () => openModal(lead.id));
                    tableBody.appendChild(row);
                });
            };
            
            const openModal = (leadId) => {
                const lead = mockLeads.find(l => l.id === leadId);
                if (!lead || !leadModalEl) return;
                currentLeadId = leadId;

                document.getElementById('modal-lead-name').textContent = lead.full_name || 'Lead sem nome';
                document.getElementById('modal-lead-email').textContent = lead.email || 'Email não informado';
                document.getElementById('modal-lead-phone').textContent = lead.phone_number ? `Tel: ${lead.phone_number}` : 'Telefone não informado';
                
                const modalBodyDetails = document.getElementById('modal-body-details');
                modalBodyDetails.innerHTML = `
                    <div><p class="font-semibold text-slate-600">Campanha:</p><p id="modal-lead-campaign" class="text-slate-800">${lead.campaign_name || 'N/A'}</p></div>
                    <div><p class="font-semibold text-slate-600">Origem:</p><p id="modal-lead-source" class="text-slate-800">${lead.source || 'N/A'}</p></div>
                    <div><p class="font-semibold text-slate-600">Data de Criação:</p><p id="modal-lead-date" class="text-slate-800">${lead.created_time ? new Date(lead.created_time).toLocaleString('pt-BR') : 'N/A'}</p></div>
                `;

                document.getElementById('modal-lead-status').value = lead.status;
                document.getElementById('modal-lead-notes').value = lead.notes || '';
                
                document.getElementById('modal-form-fields').classList.remove('hidden');
                document.getElementById('modal-save').classList.remove('hidden');
                document.getElementById('modal-cancel').textContent = 'Cancelar';

                leadModalEl.classList.remove('hidden');
            };

            const closeModal = () => { 
                if(leadModalEl) leadModalEl.classList.add('hidden');
                currentLeadId = null;
                const modalCancelBtn = document.getElementById('modal-cancel');
                if(modalCancelBtn) modalCancelBtn.textContent = 'Fechar';
            };

            const saveLeadChanges = () => { 
                if (currentLeadId === null) return;
                const lead = mockLeads.find(l => l.id === currentLeadId);
                if (lead) {
                    lead.status = document.getElementById('modal-lead-status').value;
                    lead.notes = document.getElementById('modal-lead-notes').value;
                }
                closeModal();
                updateAllVisuals(); 
            };

            const handleFileSelect = () => { 
                 const fileNameEl = document.getElementById('file-name');
                 const fileUploadEl = document.getElementById('file-upload');
                 const processBtn = document.getElementById('process-upload');
                 if (fileNameEl && fileUploadEl.files.length > 0) {
                    fileNameEl.textContent = `Arquivo selecionado: ${fileUploadEl.files[0].name}`;
                    if(processBtn) processBtn.disabled = false;
                 } else {
                    if(fileNameEl) fileNameEl.textContent = "";
                    if(processBtn) processBtn.disabled = true;
                 }
            };
            const processUpload = () => { 
                const feedbackEl = document.getElementById('upload-feedback');
                if (feedbackEl) feedbackEl.innerHTML = `<p class="text-blue-600">Processando...</p>`;
                 setTimeout(() => {
                    if (feedbackEl) feedbackEl.innerHTML = `<p class="text-green-600">Upload simulado com sucesso!</p>`;
                }, 1000);
            };

            const openWhatsAppSupport = () => {
                const phoneNumber = "5511999998888"; 
                const message = encodeURIComponent("Olá! Preciso de suporte com o sistema Lead Manager.");
                window.open(`https://wa.me/${phoneNumber}?text=${message}`, '_blank');
            };

            initializeSystem();
        });
    </script>
</body>
</html>
